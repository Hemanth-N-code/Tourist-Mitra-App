const express=require('express');const Report=require('../models/Report');const { auth, adminOnly }=require('../middleware/auth');const r=express.Router(); r.use(auth, adminOnly); r.get('/reports', async (req,res)=>{ const reps=await Report.find().populate('user').sort({createdAt:-1}).limit(500); res.json(reps);}); r.put('/reports/:id/status', async (req,res)=>{ const {status}=req.body; if(!['pending','approved','rejected'].includes(status)) return res.status(400).json({error:'Invalid'}); const rep=await Report.findByIdAndUpdate(req.params.id,{status},{new:true}); res.json(rep);}); r.delete('/reports/:id', async (req,res)=>{ const rep=await Report.findByIdAndDelete(req.params.id); res.json({ok:true,deleted:!!rep});}); module.exports=r;
